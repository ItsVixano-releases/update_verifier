#!/system/bin/sh

# SPDX-FileCopyrightText: 2017-2021 The LineageOS Project
# SPDX-License-Identifier: Apache-2.0

# Release keys
media_cert_release='308205c2308203aa020101300d06092a864886f70d01010b05003081a5310b30090603550406130249543111300f06035504080c0843616c61627269613110300e06035504070c07436f73656e7a6131173015060355040a0c0e47696f76616e6e6920526963636131173015060355040b0c0e47696f76616e6e692052696363613117301506035504030c0e47696f76616e6e692052696363613126302406092a864886f70d010901161767696f76616e6e6972696363614070726f746f6e2e6d653020170d3235303130353037343335345a180f32303532303532333037343335345a3081a5310b30090603550406130249543111300f06035504080c0843616c61627269613110300e06035504070c07436f73656e7a6131173015060355040a0c0e47696f76616e6e6920526963636131173015060355040b0c0e47696f76616e6e692052696363613117301506035504030c0e47696f76616e6e692052696363613126302406092a864886f70d010901161767696f76616e6e6972696363614070726f746f6e2e6d6530820222300d06092a864886f70d01010105000382020f003082020a0282020100892f968651d3a1add9713b2951329c421b3a158dfcded07ea73621cdf6ae6331347c942a3939b23a4e8b4f8cf078ace195465ffa9b1a137de2f318d078aa301a81915b1a3c58f916185d5a07dcca299e3657eb6b1a430d2019069a1e46044a20cdcccfc3b6b7a8f99d3dd56200b9e1ca6d431a827449f869effd7c9d228c9837435af739e81e6142525304e3d946e87ef00138d666488eecea9d9f92a6e972c9a384bc6f99bee2c7f7eb4683d3143c564144d3ed855994b2f0011eb7c4e189775c982341c87efb6a0b9e27350f7090174162ec98116d0b9874c6c1fdefce48f7b4207620bcf9a6d33223d39c5e72740e81880fca9d1b56164c6d1df6c26197c24ffd21ce44e00b3fa53f1c6baa5b4355fa370b059a17fc5f3925c3ad6c8fed76e1b6b0cb3312ba4452b9923a796d46520fcb2d16079a907aa0cc5158c6a9428a74b4eeca4c1718514050f1609cc1ab44f90040f54cfe0036dbdca68a7d6b6afe1b626c76f1f3de085142de97e116c90ba2309503b5888887e51a3f2abdc8ef42482821b16165baf9cefdf4348901714fd997bfa6325a422e38798b1b47e7eeae9599f70d694e8358d5e773f6b3fd0c259e818e9c5876ebf8415f81ae05d86cfb3a6e27a5dd05b49b2491655233c8755fed1b0f0eaa7b69fdfc3fab59b2331a47f94480664984dcc7e4c3d60127c603e893a0811e6159a1416626ea4f2d0963a90203010001300d06092a864886f70d01010b050003820201003fddfbb332589f57ef795360734bb21f4fe0ce8436ec7fd7a26328d5c3be1336518cc3fec7bf7ed0eb7fbc65a4f32286173c0539b4a9907bca0b35734011f30bc884a57505d56cab954d9e95cebef73a4f54ccb83b9afb6bc70205dcf4726c4382e43566d5e28e5d1cf8530fb87ebc3137a1135a0bf70a5531110dabb5f68ef436e65b9599e20d87c8687c28962d0c46858ce4d714d23bc90abb3773c6df12a9f490fe2f54064b3711e7fb22295ab25fe208719d2d0dfa1c0105758d092bc52835df44b95f0fff32a156f090beb99178307fc6e23cfc90607b235efa902db21bcea1cdda7df7045194ed330087ed5161802f294b900d035489785305675e5da23495fae024745932bf013e359aa7822ab2e506ba47da4e900559b43701bb2c0e2e6c79fc57d5e305f8a8c121ee8edfc25e7be38489cd6bc984d98814da3d8f888395767fc96e56a0c2f161cb191a9c333c808944950a4d0bac8377c5d4ecb7cad2589cc3bb64f6fe4e6ff7151e74cac89b60fcf0138bf6dbc10337f10b83b6fbf923f59f3f439622252bf4a100b701ee43d91bbc6cdbe8aa739fd8c7e51a76819bb93188fd82a77793a04f8a595f1b349c511c5237e76c0c708f9047092eafc412c41fd4af6573137de0b30e87f58e96a1c045d7e66d745e5982647e36322a2d504ae65f48f0f9b56b8cc6049556f32f3459cd8de5b8c21033b00b5ccbcbd7d4'
media_key_release='MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAiS+WhlHToa3ZcTspUTKcQhs6FY383tB+pzYhzfauYzE0fJQqOTmyOk6LT4zweKzhlUZf+psaE33i8xjQeKowGoGRWxo8WPkWGF1aB9zKKZ42V+trGkMNIBkGmh5GBEogzczPw7a3qPmdPdViALnhym1DGoJ0Sfhp7/18nSKMmDdDWvc56B5hQlJTBOPZRuh+8AE41mZIjuzqnZ+SpulyyaOEvG+ZvuLH9+tGg9MUPFZBRNPthVmUsvABHrfE4Yl3XJgjQch++2oLnic1D3CQF0Fi7JgRbQuYdMbB/e/OSPe0IHYgvPmm0zIj05xecnQOgYgPyp0bVhZMbR32wmGXwk/9Ic5E4As/pT8ca6pbQ1X6NwsFmhf8Xzklw61sj+124bawyzMSukRSuZI6eW1GUg/LLRYHmpB6oMxRWMapQop0tO7KTBcYUUBQ8WCcwatE+QBA9Uz+ADbb3KaKfWtq/htibHbx894IUULel+EWyQuiMJUDtYiIh+UaPyq9yO9CSCghsWFluvnO/fQ0iQFxT9mXv6YyWkIuOHmLG0fn7q6VmfcNaU6DWNXnc/az/QwlnoGOnFh26/hBX4GuBdhs+zpuJ6XdBbSbJJFlUjPIdV/tGw8Oqntp/fw/q1myMxpH+USAZkmE3Mfkw9YBJ8YD6JOggR5hWaFBZibqTy0JY6kCAwEAAQ=='
platform_cert_release='308205c2308203aa020101300d06092a864886f70d01010b05003081a5310b30090603550406130249543111300f06035504080c0843616c61627269613110300e06035504070c07436f73656e7a6131173015060355040a0c0e47696f76616e6e6920526963636131173015060355040b0c0e47696f76616e6e692052696363613117301506035504030c0e47696f76616e6e692052696363613126302406092a864886f70d010901161767696f76616e6e6972696363614070726f746f6e2e6d653020170d3235303130353037343335345a180f32303532303532333037343335345a3081a5310b30090603550406130249543111300f06035504080c0843616c61627269613110300e06035504070c07436f73656e7a6131173015060355040a0c0e47696f76616e6e6920526963636131173015060355040b0c0e47696f76616e6e692052696363613117301506035504030c0e47696f76616e6e692052696363613126302406092a864886f70d010901161767696f76616e6e6972696363614070726f746f6e2e6d6530820222300d06092a864886f70d01010105000382020f003082020a0282020100d145842d27be262a45700ff61d35b91d0caaa1bac7b497a385f9ca209378ff43efbdaeda0bcd8093476a11752727bdf4b928051dbbe8c90210d05d20ad6b6d2104c74e04c4ae086c46c1a314ccf299048406c26674e231b235b95c0040a5f9d6fed1afc13d8fcd5e734b1693feccb0f379801b7f486885da190aa55c5fccb981b7e86af51b3f5c867fb407aecc1b23521b6d94c01209c7a5cd6947871024cff6f33612091f19c612d7122355c26e7be4dd28bb269d6c66bbd768c5a7f1536b66bbd46e1fdee7becd5a71ae3866117e7e36dc1ed25becdb826a7154f70d182739ede2b09ded9daf0bab49c2a6e278d3cef4bc2248e09491ef0fa0f7d15375e524d4cf0b61e313f16c0ea96825656ddef017e339c562269035d59c5481a79d510ae7aadeceb31222fb50c6da239410e6324c0829c6fa65a4317d15cc2cf78106fc6052fc3a61b3403d77f35f1badfd0b29840dd4038a0f50369a787a4596850b9718a1d41e91d29491040fbc8f5e994b8d6d7eefb70cea463f6986b061b7295cbca6f8af3b23eae046a0b0d68d8d8efcd9920e6fa5a29029f16a40fc33e0866ff9c0334743cda7559f3ae197fa7cec8e9e3b4729644b692bdb69bff04a61b2c8e48db0d26e380fa1e3f47d7fa17df7ce7260c480d63245995ed5e1c3bb290d681fe45a30af0e93ef33ea23991dfaa74ab75c1a3e122e587a59a085e5d19f70e81d0203010001300d06092a864886f70d01010b050003820201001bd49877c0a2e2bacb3c802758601c4cd70d24dce4a6d78654837e8b7a585bafbda11166614db4066022bdfff749c7e6251dd1b26ce4cffaa12bb7016ae827e750f860be8802b137621d3c874ca7406b5d65955d0457cca3ceb40d2ec8a3a14ce32642145a206a7863ffcad000ad2b8c69661fed2a165071e19cec6b7ae8a1ea0087e80f355c2ddbd3dd4b806095c8221b5e6e322fdf3d1d80fb2a626493c7529107c91359155c9a6b14fe900b86aa0cdf1f9b52d3a0bb654b777d35652e638c4fda7122f0cc936981286ca0641956b91e95185190a9d357551cbd403035e7735c42300f7e4037ad76eee1dd29b5f603b3c2ae5cc080ffbf8f8f3eb89ac6d48fa777556f95db95ac2ac404d62c1b73931eac758abe9cae634f893668eb6afbcedf8c1be5d4878ff6985fa5f93794632c774ba8f49710044da4982d96e79334bbe114c543a1c08c1fa25b76936e8525261de1424c84a1300b6a1084a6e398bb8dbdc2212ed3174af67497352bfdacce43a7966572607a2c2f70be8015bafe13fee8cbef23b1727226a80196031d202a9c5f2ec59b94fc75621314ae31f5a9b24c912252b1695a14814817754472c0338c56e72a54b8905230fcef32a6680d4245835a4596f2a715e4f9466340cdbcaf3270bc8113edddde709861c3dfcf5933a00c53e4e9ea3a35637c5b56310ab58cb48175e10084d42f0521aaaf8ff3be8702'
platform_key_release='MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA0UWELSe+JipFcA/2HTW5HQyqobrHtJejhfnKIJN4/0Pvva7aC82Ak0dqEXUnJ730uSgFHbvoyQIQ0F0grWttIQTHTgTErghsRsGjFMzymQSEBsJmdOIxsjW5XABApfnW/tGvwT2PzV5zSxaT/syw83mAG39IaIXaGQqlXF/MuYG36Gr1Gz9chn+0B67MGyNSG22UwBIJx6XNaUeHECTP9vM2EgkfGcYS1xIjVcJue+TdKLsmnWxmu9doxafxU2tmu9RuH97nvs1aca44ZhF+fjbcHtJb7NuCanFU9w0YJznt4rCd7Z2vC6tJwqbieNPO9LwiSOCUke8PoPfRU3XlJNTPC2HjE/FsDqloJWVt3vAX4znFYiaQNdWcVIGnnVEK56rezrMSIvtQxtojlBDmMkwIKcb6ZaQxfRXMLPeBBvxgUvw6YbNAPXfzXxut/QsphA3UA4oPUDaaeHpFloULlxih1B6R0pSRBA+8j16ZS41tfu+3DOpGP2mGsGG3KVy8pvivOyPq4EagsNaNjY782ZIOb6WikCnxakD8M+CGb/nAM0dDzadVnzrhl/p87I6eO0cpZEtpK9tpv/BKYbLI5I2w0m44D6Hj9H1/oX33znJgxIDWMkWZXtXhw7spDWgf5Fowrw6T7zPqI5kd+qdKt1waPhIuWHpZoIXl0Z9w6B0CAwEAAQ=='
shared_cert_release='308205c2308203aa020101300d06092a864886f70d01010b05003081a5310b30090603550406130249543111300f06035504080c0843616c61627269613110300e06035504070c07436f73656e7a6131173015060355040a0c0e47696f76616e6e6920526963636131173015060355040b0c0e47696f76616e6e692052696363613117301506035504030c0e47696f76616e6e692052696363613126302406092a864886f70d010901161767696f76616e6e6972696363614070726f746f6e2e6d653020170d3235303130353037343335375a180f32303532303532333037343335375a3081a5310b30090603550406130249543111300f06035504080c0843616c61627269613110300e06035504070c07436f73656e7a6131173015060355040a0c0e47696f76616e6e6920526963636131173015060355040b0c0e47696f76616e6e692052696363613117301506035504030c0e47696f76616e6e692052696363613126302406092a864886f70d010901161767696f76616e6e6972696363614070726f746f6e2e6d6530820222300d06092a864886f70d01010105000382020f003082020a0282020100b3c240e39913ec5b61094cdc722ecf0a7ac2a2ef5924d50f16e531f7e6fb725030fa6b0fddfd4eb68c24549a2ad4bf3a49e73be61d46b31021679216d6daf3437f3b614b4ceee96eeb479a9e3d2d6a5bf0bce294c443b5f5a2601a9563259a5c9fd49bda9c3dc5075296f315a5ad53ce0ba18765d87fd2ea5f943651c3ee7856396b2dd2e8868431e3f0e9e87d7885dadaff7bf7dc2e0014673d20df15854f615aa7310d5ad06d1777327cffb467be1f01176982197cf6fb82b9a439a5c6cc638cd4d93969f517a7a2b9d6699d552cc053c4e17cfb9130d2c667531dd60d386e226dc18e30398976e2e47c6681a3c314615873350ca1e6324f112ff484f8c2a8308ee2b84c9b876907e24363117a0771aa51bafa9b046338ccaf20e8563aa7cbd50776b8a3de30e4947440972241d3cfd335d4ec920e8d4763fc0cc24377e89acd8cb1224289c5ddf118644b86d707e3d40c69b23e50bcccd2f6b1834ef378f7a834a47d0dd60a3bbffe7305bab2e7a1d5193bf82310efa85c168047d120c12600cabd3d105a22daf65fb12cd1466351dcd8bfeb3f7aa64fe43481df8733cb3fe59876dbf2d5b741310edf3b757a2e438702b0e562b9a68b5301e6da41a815fa8684a1be0db89845a336e0d64628079db7efb2646b003622fc789c543475434e05a9b9047d0a6e53964b3454f8d8bc8a97ebace1646b8abc659a4674202677ab0203010001300d06092a864886f70d01010b05000382020100692322278f9febe3d0780334d59d0f8d8b66f5939437aa9908febaf4be171bccd675bd44b893c38fe58595981a7970ae587c2bf755c04cff5e2fa62ad334eee6138fd07c6dfadc9b9cdbce7a6eaa0862afeddca9e5244aee59f4c01994fbb947912acbd68467dd75f1dd51383e06d907fbd4ae8790d1af3b2b3efbe878bfafdae2c9caea42c759bf3c6062abf8e4a7e9c8fffd490c331732fac86db14be03d90652950b6fc643eae664cbd48b31ff08eb29466bf686c1e275376e6f45e04f8b9fc896b3dc35f02b1d673be408134492c3c6dcdab5bcc1de4ef93ddadf7c464bc286a23c45c9402a2d262395f193205ab465507b162ec0a9cf6ce0d6e2001c7370a2c6e33d00b05bf496498eb07a464254953366aa21ee4c2ef55408c07593e2109e852035fe4fb822f389031a972e27920dc08143bf03e74421e04b0fca6865fc1fb726891249fb15c002c3dd23ee0e4715fb422a85b217645506e8ff12f73d22f06417c91f8816a67d384a83b7075a612374378c4ae4cf086624261396b1be3c19fad45ae10c6ded81ff8d0251d2dbae3aedc9c8b07c704347453a9570bae6d7ad8e70ab7709cd8cb7c5787a4f86d18421f6eba903e1c5d4be8cf63879581f5ad27a90fbc06ab72202ea092250b99f72918d6fb6f21e567a6ef50d1f281c4362a52e57b99289c2c4269eab6b1a696f2a8dc83eb103c4ca280ba9a780534f2b3'
shared_key_release='MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAs8JA45kT7FthCUzcci7PCnrCou9ZJNUPFuUx9+b7clAw+msP3f1OtowkVJoq1L86Sec75h1GsxAhZ5IW1trzQ387YUtM7ulu60eanj0talvwvOKUxEO19aJgGpVjJZpcn9Sb2pw9xQdSlvMVpa1Tzguhh2XYf9LqX5Q2UcPueFY5ay3S6IaEMePw6eh9eIXa2v9799wuABRnPSDfFYVPYVqnMQ1a0G0XdzJ8/7Rnvh8BF2mCGXz2+4K5pDmlxsxjjNTZOWn1F6eiudZpnVUswFPE4Xz7kTDSxmdTHdYNOG4ibcGOMDmJduLkfGaBo8MUYVhzNQyh5jJPES/0hPjCqDCO4rhMm4dpB+JDYxF6B3GqUbr6mwRjOMyvIOhWOqfL1Qd2uKPeMOSUdECXIkHTz9M11OySDo1HY/wMwkN36JrNjLEiQonF3fEYZEuG1wfj1Axpsj5QvMzS9rGDTvN496g0pH0N1go7v/5zBbqy56HVGTv4IxDvqFwWgEfRIMEmAMq9PRBaItr2X7Es0UZjUdzYv+s/eqZP5DSB34czyz/lmHbb8tW3QTEO3zt1ei5DhwKw5WK5potTAebaQagV+oaEob4NuJhFozbg1kYoB52377JkawA2Ivx4nFQ0dUNOBam5BH0KblOWSzRU+Ni8ipfrrOFka4q8ZZpGdCAmd6sCAwEAAQ=='
release_cert='308205c2308203aa020101300d06092a864886f70d01010b05003081a5310b30090603550406130249543111300f06035504080c0843616c61627269613110300e06035504070c07436f73656e7a6131173015060355040a0c0e47696f76616e6e6920526963636131173015060355040b0c0e47696f76616e6e692052696363613117301506035504030c0e47696f76616e6e692052696363613126302406092a864886f70d010901161767696f76616e6e6972696363614070726f746f6e2e6d653020170d3235303130353037343335375a180f32303532303532333037343335375a3081a5310b30090603550406130249543111300f06035504080c0843616c61627269613110300e06035504070c07436f73656e7a6131173015060355040a0c0e47696f76616e6e6920526963636131173015060355040b0c0e47696f76616e6e692052696363613117301506035504030c0e47696f76616e6e692052696363613126302406092a864886f70d010901161767696f76616e6e6972696363614070726f746f6e2e6d6530820222300d06092a864886f70d01010105000382020f003082020a0282020100cf26f6a96c48ba1697a7106596c13ec71f0c19d1f8ca265ec7f0f060826c479ef58ff5d90778b0c518a01d641eb191743a3411aa9eb9d0a9a73b60bab2d6ebe4471f5cc612a24df99bc756479ebd33fb5ae18fe8247b688e122641d7de10771bbc2551c71b030509add73d88b43996e357b1e5ff1dcf2095574161edd54acf79e26a503004be9a8c06ce8bb84bbbd17173cab08aacd3efa7bff1e67d83f9a1ac51dbbbcb48f699a7f227153129c6b4e1b44f98cab029f0566fa8485344c6e4f6003173cee506d2a0eed8a12bc5360315be9028fa1c414140f957661e961b1c5d330657420665d4d98dd8bd47b76ad4bc332ba5b13ea4b1526feff76a54a67bacf198311fbb49d9bf4a0d2ecbdd735034d9fec73a890622334e66c39c11edd81eb5fce0be9543a96ca19953fa08cd222c47a2df7382285c720a85df5201183e4fbca18e093bcb25cddce2f46edf1c601c027a5d31e49af0225592a968751ebdafa8eec68c14bdde273f736a43823d99e9d65d6175fc5e4975152c9d591c9c072282795ce824459c2cbd2429c4217db5ab0d2ae6893a2b90ce62f5cd72f7c1b226b5b4084878b1ac270499326cf677cfe8c5797e46c8906224dd2a81dbefb8a64f93bd903174c59979586b2aa06f296984af6439990bdca391b13d38b701ae8ebfb6df8f8014cd9c006c518b41bb4583fb750a7e2f4c6775bce7016860a8eadc670203010001300d06092a864886f70d01010b05000382020100b5fe474cd3091347ee429aba36961536833661408464a78d442d6941524235e45f5a71e4fc813f6fe7fad46ab086e38369570e1a1df31de014b867d969f5f981d3320acfff90b5558ff90b14e4d1ee51bfbfca9b05f3230d11cd95a68a5b8613f0f19bd834e952ddb59e4b032d25a04f1db881b28289532160c2a1f9f98c6501a059cac324d193ee1c6a0437727b935f8710a918f778067a9d49b7ee861776a29f624b8ea28e593f8562c2b0ed6b07edf8c307d169408d240eaa9fb2447f0421e39e4f8161154a05f915231805bed91a9bd4f5c80017fc6e7e76453063fd01ba6a20580e7145e1af5372e46a48a52abac16263ddcec4b77b22a85d2e4a19e96530360ceabe602caf766a89f262da4e9ecf8e96571ffeb48b0b754aa6d17946ef649874679273290e98f3bb0510546fa210866566a5c6951509857a8b297be29a99f31b20a3d85b37384690eca26e5f8ea7f46337796b7d504f250603238ae956dd7319ac8b1a35014f8c2a679fb93f01055ad8817eae2364e02c32818eae610f54b80830c933cedf40671eb313db8f879e0cc6f6deb76d3f4525ebaa303b6da46437f1350cdfb6793d53429d3b83a7f4af59565eb37668f061ac233e58e1a1c7e255d01af3f559db7c7d207075f1be569f9dc42789554e46da09a238d728e61f4988d1c2d711f803cdcc53bb781c59a75a46df941cd8404814d0a33db88f12d0'
release_key='MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAzyb2qWxIuhaXpxBllsE+xx8MGdH4yiZex/DwYIJsR571j/XZB3iwxRigHWQesZF0OjQRqp650KmnO2C6stbr5EcfXMYSok35m8dWR569M/ta4Y/oJHtojhImQdfeEHcbvCVRxxsDBQmt1z2ItDmW41ex5f8dzyCVV0Fh7dVKz3nialAwBL6ajAbOi7hLu9Fxc8qwiqzT76e/8eZ9g/mhrFHbu8tI9pmn8icVMSnGtOG0T5jKsCnwVm+oSFNExuT2ADFzzuUG0qDu2KErxTYDFb6QKPocQUFA+VdmHpYbHF0zBldCBmXU2Y3YvUe3atS8MyulsT6ksVJv7/dqVKZ7rPGYMR+7Sdm/Sg0uy91zUDTZ/sc6iQYiM05mw5wR7dgetfzgvpVDqWyhmVP6CM0iLEei33OCKFxyCoXfUgEYPk+8oY4JO8slzdzi9G7fHGAcAnpdMeSa8CJVkqlodR69r6juxowUvd4nP3NqQ4I9menWXWF1/F5JdRUsnVkcnAcignlc6CRFnCy9JCnEIX21qw0q5ok6K5DOYvXNcvfBsia1tAhIeLGsJwSZMmz2d8/oxXl+RsiQYiTdKoHb77imT5O9kDF0xZl5WGsqoG8paYSvZDmZC9yjkbE9OLcBro6/tt+PgBTNnABsUYtBu0WD+3UKfi9MZ3W85wFoYKjq3GcCAwEAAQ=='

# Test keys
media_cert_test='308204a830820390a003020102020900f2b98e6123572c4e300d06092a864886f70d0101040500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303431353233343035375a170d3335303930313233343035375a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d00308201080282010100ae250c5a16ef97fc2869ac651b3217cc36ba0e86964168d58a049f40ce85867123a3ffb4f6d949c33cf2da3a05c23eacaa57d803889b1759bcf59e7c6f21890ae25085b7ed56aa626c0989ef9ccd36362ca0e8d1b9603fd4d8328767926ccc090c68b775ae7ff30934cc369ef2855a2667df0c667fd0c7cf5d8eba655806737303bb624726eabaedfb72f07ed7a76ab3cb9a381c4b7dcd809b140d891f00213be401f58d6a06a61eadc3a9c2f1c6567285b09ae09342a66fa421eaf93adf7573a028c331d70601ab3af7cc84033ece7c772a3a5b86b0dbe9d777c3a48aa9801edcee2781589f44d9e4113979600576a99410ba81091259dad98c6c68ff784b8f020103a381fc3081f9301d0603551d0e04160414ca293caa8bc0ed3e542eef4205a2bff2b57e4d753081c90603551d230481c13081be8014ca293caa8bc0ed3e542eef4205a2bff2b57e4d75a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900f2b98e6123572c4e300c0603551d13040530030101ff300d06092a864886f70d0101040500038201010084de9516d5e4a87217a73da8487048f53373a5f733f390d61bdf3cc9e5251625bfcaa7c3159cae275d172a9ae1e876d5458127ac542f68290dd510c0029d8f51e0ee156b7b7b5acdb394241b8ec78b74e5c42c5cafae156caf5bd199a23a27524da072debbe378464a533630b0e4d0ffb7e08ecb701fadb6379c74467f6e00c6ed888595380792038756007872c8e3007af423a57a2cab3a282869b64c4b7bd5fc187d0a7e2415965d5aae4e07a6df751b4a75e9793c918a612b81cd0b628aee0168dc44e47b10d3593260849d6adf6d727dc24444c221d3f9ecc368cad07999f2b8105bc1f20d38d41066cc1411c257a96ea4349f5746565507e4e8020a1a81'
media_key_test='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAriUMWhbvl/woaaxlGzIXzDa6DoaWQWjVigSfQM6FhnEjo/+09tlJwzzy2joFwj6sqlfYA4ibF1m89Z58byGJCuJQhbftVqpibAmJ75zNNjYsoOjRuWA/1Ngyh2eSbMwJDGi3da5/8wk0zDae8oVaJmffDGZ/0MfPXY66ZVgGc3MDu2JHJuq67fty8H7Xp2qzy5o4HEt9zYCbFA2JHwAhO+QB9Y1qBqYercOpwvHGVnKFsJrgk0Kmb6Qh6vk633VzoCjDMdcGAas698yEAz7OfHcqOluGsNvp13fDpIqpgB7c7ieBWJ9E2eQROXlgBXaplBC6gQkSWdrZjGxo/3hLjwIBAw=='
platform_cert_test='308204a830820390a003020102020900b3998086d056cffa300d06092a864886f70d0101040500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303431353232343035305a170d3335303930313232343035305a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d003082010802820101009c780592ac0d5d381cdeaa65ecc8a6006e36480c6d7207b12011be50863aabe2b55d009adf7146d6f2202280c7cd4d7bdb26243b8a806c26b34b137523a49268224904dc01493e7c0acf1a05c874f69b037b60309d9074d24280e16bad2a8734361951eaf72a482d09b204b1875e12ac98c1aa773d6800b9eafde56d58bed8e8da16f9a360099c37a834a6dfedb7b6b44a049e07a269fccf2c5496f2cf36d64df90a3b8d8f34a3baab4cf53371ab27719b3ba58754ad0c53fc14e1db45d51e234fbbe93c9ba4edf9ce54261350ec535607bf69a2ff4aa07db5f7ea200d09a6c1b49e21402f89ed1190893aab5a9180f152e82f85a45753cf5fc19071c5eec827020103a381fc3081f9301d0603551d0e041604144fe4a0b3dd9cba29f71d7287c4e7c38f2086c2993081c90603551d230481c13081be80144fe4a0b3dd9cba29f71d7287c4e7c38f2086c299a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900b3998086d056cffa300c0603551d13040530030101ff300d06092a864886f70d01010405000382010100572551b8d93a1f73de0f6d469f86dad6701400293c88a0cd7cd778b73dafcc197fab76e6212e56c1c761cfc42fd733de52c50ae08814cefc0a3b5a1a4346054d829f1d82b42b2048bf88b5d14929ef85f60edd12d72d55657e22e3e85d04c831d613d19938bb8982247fa321256ba12d1d6a8f92ea1db1c373317ba0c037f0d1aff645aef224979fba6e7a14bc025c71b98138cef3ddfc059617cf24845cf7b40d6382f7275ed738495ab6e5931b9421765c491b72fb68e080dbdb58c2029d347c8b328ce43ef6a8b15533edfbe989bd6a48dd4b202eda94c6ab8dd5b8399203daae2ed446232e4fe9bd961394c6300e5138e3cfd285e6e4e483538cb8b1b357'
platform_key_test='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAnHgFkqwNXTgc3qpl7MimAG42SAxtcgexIBG+UIY6q+K1XQCa33FG1vIgIoDHzU172yYkO4qAbCazSxN1I6SSaCJJBNwBST58Cs8aBch09psDe2AwnZB00kKA4WutKoc0NhlR6vcqSC0JsgSxh14SrJjBqnc9aAC56v3lbVi+2OjaFvmjYAmcN6g0pt/tt7a0SgSeB6Jp/M8sVJbyzzbWTfkKO42PNKO6q0z1M3GrJ3GbO6WHVK0MU/wU4dtF1R4jT7vpPJuk7fnOVCYTUOxTVge/aaL/SqB9tffqIA0JpsG0niFAL4ntEZCJOqtakYDxUugvhaRXU89fwZBxxe7IJwIBAw=='
shared_cert_test='308204a830820390a003020102020900f2a73396bd38767a300d06092a864886f70d0101040500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303732333231353735395a170d3335313230393231353735395a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d00308201080282010100c8c2dbfd094a2df45c3ff1a32ed21805ec72fc58d017971bd0f6b52c262d70819d191967e158dfd3a2c7f1b3e0e80ce545d79d2848220211eb86f0fd8312d37b420c113750cc94618ae872f4886463bdc4627caa0c0483c86493e3515571170338bfdcc4cd6addd1c0a2f35f5cf24ed3e4043a3e58e2b05e664ccde12bcb67735fd6df1249c369e62542bc0a4729e53917f5c38ffa52d17b73c9c73798ddb18ed481590875547e66bfc5daca4c25a6eb960ed96923709da302ba646cb496b325e86c5c8b2e7a3377b2bbe4c7cf33254291163f689152ac088550c83c508f4bf5adf0aed5a2dca0583f9ab0ad17650db7eea4b23fdb45885547d0feab72183889020103a381fc3081f9301d0603551d0e04160414cb4c7e2cdbb3f0ada98dab79968d172e9dbb1ed13081c90603551d230481c13081be8014cb4c7e2cdbb3f0ada98dab79968d172e9dbb1ed1a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900f2a73396bd38767a300c0603551d13040530030101ff300d06092a864886f70d0101040500038201010040a8d096997959e917a36c44246b6bac2bae05437ecd89794118f7834720352d1c6f8a39b0869942f4da65981faa2951d33971129ec1921d795671c527d6e249f252829faf5b591310311e2de096500d568ad4114a656dc34a8c6f610453afc1ea7992dba4aa7b3f8543a6e35c0728de77fe97eeac83771fd0ec90f8e4449434ee0b6045783e70c7a2e460249260e003cf7608dc352a4c9ef706def4b26050e978ae2fffd7a3323787014915eb3cc874fcc7a9ae930877c5c8c7d1c2e2a8ee863c89180d1855cedba400e7ba43cccaa7243d397e7c0e8e8e4d7d4f92b6bbead49c0cf018069eddca2e7e2fb4668d89dbbd7950d0cd254180fa1eaafc2a556f84'
shared_key_test='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAyMLb/QlKLfRcP/GjLtIYBexy/FjQF5cb0Pa1LCYtcIGdGRln4Vjf06LH8bPg6AzlRdedKEgiAhHrhvD9gxLTe0IMETdQzJRhiuhy9IhkY73EYnyqDASDyGST41FVcRcDOL/cxM1q3dHAovNfXPJO0+QEOj5Y4rBeZkzN4SvLZ3Nf1t8SScNp5iVCvApHKeU5F/XDj/pS0Xtzycc3mN2xjtSBWQh1VH5mv8XaykwlpuuWDtlpI3CdowK6ZGy0lrMl6Gxciy56M3eyu+THzzMlQpEWP2iRUqwIhVDIPFCPS/Wt8K7VotygWD+asK0XZQ237qSyP9tFiFVH0P6rchg4iQIBAw=='
test_cert='308204a830820390a003020102020900936eacbe07f201df300d06092a864886f70d0101050500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303232393031333334365a170d3335303731373031333334365a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d00308201080282010100d6931904dec60b24b1edc762e0d9d8253e3ecd6ceb1de2ff068ca8e8bca8cd6bd3786ea70aa76ce60ebb0f993559ffd93e77a943e7e83d4b64b8e4fea2d3e656f1e267a81bbfb230b578c20443be4c7218b846f5211586f038a14e89c2be387f8ebecf8fcac3da1ee330c9ea93d0a7c3dc4af350220d50080732e0809717ee6a053359e6a694ec2cb3f284a0a466c87a94d83b31093a67372e2f6412c06e6d42f15818dffe0381cc0cd444da6cddc3b82458194801b32564134fbfde98c9287748dbf5676a540d8154c8bbca07b9e247553311c46b9af76fdeeccc8e69e7c8a2d08e782620943f99727d3c04fe72991d99df9bae38a0b2177fa31d5b6afee91f020103a381fc3081f9301d0603551d0e04160414485900563d272c46ae118605a47419ac09ca8c113081c90603551d230481c13081be8014485900563d272c46ae118605a47419ac09ca8c11a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900936eacbe07f201df300c0603551d13040530030101ff300d06092a864886f70d010105050003820101007aaf968ceb50c441055118d0daabaf015b8a765a27a715a2c2b44f221415ffdace03095abfa42df70708726c2069e5c36eddae0400be29452c084bc27eb6a17eac9dbe182c204eb15311f455d824b656dbe4dc2240912d7586fe88951d01a8feb5ae5a4260535df83431052422468c36e22c2a5ef994d61dd7306ae4c9f6951ba3c12f1d1914ddc61f1a62da2df827f603fea5603b2c540dbd7c019c36bab29a4271c117df523cdbc5f3817a49e0efa60cbd7f74177e7a4f193d43f4220772666e4c4d83e1bd5a86087cf34f2dec21e245ca6c2bb016e683638050d2c430eea7c26a1c49d3760a58ab7f1a82cc938b4831384324bd0401fa12163a50570e684d'
test_key='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEA1pMZBN7GCySx7cdi4NnYJT4+zWzrHeL/Boyo6LyozWvTeG6nCqds5g67D5k1Wf/ZPnepQ+foPUtkuOT+otPmVvHiZ6gbv7IwtXjCBEO+THIYuEb1IRWG8DihTonCvjh/jr7Pj8rD2h7jMMnqk9Cnw9xK81AiDVAIBzLggJcX7moFM1nmppTsLLPyhKCkZsh6lNg7MQk6ZzcuL2QSwG5tQvFYGN/+A4HMDNRE2mzdw7gkWBlIAbMlZBNPv96YySh3SNv1Z2pUDYFUyLvKB7niR1UzEcRrmvdv3uzMjmnnyKLQjngmIJQ/mXJ9PAT+cpkdmd+brjigshd/ox1bav7pHwIBAw=='


PACKAGES=/data/system/packages.xml
PACKAGES_INTERMEDIATE=/data/local/tmp/packages.xml.decoded
PACKAGES_BACKUP=/data/system/packages-backup.xml
MODIFICATION_TARGET=$PACKAGES

ANDROID_VERSION=$(getprop ro.build.version.release)

[ $ANDROID_VERSION -ge 12 ] && USE_ABX=1

case "$1" in
    "signed")
        to_signed=true
        echo "Unsigned to signed migration"
        ;;
    "unsigned")
        echo "signed to unsigned migration"
        ;;
    *)
        echo "USAGE: $0 signed|unsigned"
        exit 1
        ;;
esac

if [ $USE_ABX ]; then
    abx2xml $PACKAGES $PACKAGES_INTERMEDIATE
    MODIFICATION_TARGET=$PACKAGES_INTERMEDIATE
fi

# If there's a "backup" copy, then the current packages.xml might
# be corrupted, so overwrite it with the backup copy. This is what
# PackageManager would do.
if [ -f $PACKAGES_BACKUP ]; then
    mv $PACKAGES_BACKUP $PACKAGES
    echo "Overwriting $PACKAGES with $PACKAGES_BACKUP"
fi

if [ ! -f $PACKAGES ]; then
    echo "Error: $PACKAGES not found"
    exit 1
fi

# Save a copy of the current file, not to be confused with
# packages-backup.xml, which is used and generated by Android
echo "Saving backup as $PACKAGES.bak"
cp $PACKAGES $PACKAGES.bak

if [ "$to_signed" = "true" ]; then
    sed -i "s#$media_cert_test#$media_cert_release#g" $MODIFICATION_TARGET
    sed -i "s#$platform_cert_test#$platform_cert_release#g" $MODIFICATION_TARGET
    sed -i "s#$shared_cert_test#$shared_cert_release#g" $MODIFICATION_TARGET
    sed -i "s#$test_cert#$release_cert#g" $MODIFICATION_TARGET
    sed -i "s#$media_key_test#$media_key_release#g" $MODIFICATION_TARGET
    sed -i "s#$platform_key_test#$platform_key_release#g" $MODIFICATION_TARGET
    sed -i "s#$shared_key_test#$shared_key_release#g" $MODIFICATION_TARGET
    sed -i "s#$test_key#$release_key#g" $MODIFICATION_TARGET
else
    sed -i "s#$media_cert_release#$media_cert_test#g" $MODIFICATION_TARGET
    sed -i "s#$platform_cert_release#$platform_cert_test#g" $MODIFICATION_TARGET
    sed -i "s#$shared_cert_release#$shared_cert_test#g" $MODIFICATION_TARGET
    sed -i "s#$release_cert#$test_cert#g" $MODIFICATION_TARGET
    sed -i "s#$media_key_release#$media_key_test#g" $MODIFICATION_TARGET
    sed -i "s#$platform_key_release#$platform_key_test#g" $MODIFICATION_TARGET
    sed -i "s#$shared_key_release#$shared_key_test#g" $MODIFICATION_TARGET
    sed -i "s#$release_key#$test_key#g" $MODIFICATION_TARGET
fi

if [ $USE_ABX ]; then
    xml2abx $MODIFICATION_TARGET $PACKAGES.tmp
    mv $PACKAGES.tmp $PACKAGES
fi

chmod 660 $PACKAGES
chown system:system $PACKAGES

echo "Done"
